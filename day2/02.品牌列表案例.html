<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <title>品牌案例</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="stylesheet" href="https://cdn.bootcss.com/twitter-bootstrap/4.3.1/css/bootstrap.css">
        <!-- 开发环境版本，包含了有帮助的命令行警告 -->
        <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
        <!-- 需要Jquery嘛？？？ -->
    </head>
    <body>
        <!--[if lt IE 7]>
            <p class="browsehappy">You are using an <strong>outdated</strong> browser. Please <a href="#">upgrade your browser</a> to improve your experience.</p>
        <![endif]-->

        

        <div id="app">

            <div class="panel panel-primary">
                <div class="panel-heading">
                    <h3 class="panel-title">添加品牌</h3>
                </div>
                <div class="panel-body form-inline">
                    <label>
                        Id:
                        <input type="text" class="form-control" v-model="id">
                    </label>
    
                    <label>
                        Name:
                        <input type="text" class="form-control" v-model="name">
                    </label>
    
                    <!-- 在 Vue 钟，使用事件绑定机制，为元素加了括号之后，就可以传参了 -->
                    <input type="button" value="添加" class="btn btn-primary" @click="add">

                    <label>
                            搜索筛选:
                            <input type="text" class="form-control" v-model="keywords">
                        </label>
                </div>
            </div>

            <table class="table table-bordered table-hover table-striped">
                <thead>
                    <tr>
                        <th>Id</th>
                        <th>Name</th>
                        <th>Ctime</th>
                        <th>Operation</th>
                    </tr>
                </thead>
                <tbody>
                    <tr v-for="item in search(keywords)" :key="item.id">
                        <td>{{ item.id }}</td>
                        <td v-text="item.name"></td>
                        <td>{{ item.ctime | dateFormat('pattern') }}</td>
                        <td><a href="#" @click="del(item.id)">删除</a></td>
                    </tr>
                </tbody>
            </table>
        </div>

        <div id="app2">
            {{ dt | dateFormat }}
        </div>
        
        <script>
            // 全局的过滤器，进行时间的格式化
            Vue.filter('dateFormat', function (dataStr, pattern="") {
                var dt = new Date(dataStr);

                // yyyy-mm-dd
                var y = dt.getFullYear();
                var m = dt.getMonth();
                var d = dt.getDate();

                if (pattern.toLowerCase() === '') {
                    return `${y}-${m}-${d}`
                } else {
                    var hh = dt.getHours();
                    var mm = dt.getMinutes();
                    var ss = dt.getMinutes();

                    return `${y}-${m}-${d} ${hh}:${mm}:${ss}`
                }
            });
            // 创建 Vue 实例，得到ViewModel
            var vm = new Vue({
                el: '#app',
                data: {
                    id: '',
                    name: '',
                    list: [
                        {id: 1, name: '奥迪', ctime: new Date()},
                        {id: 2, name: '奔驰', ctime: new Date()},
                        {id: 3, name: '领克', ctime: new Date()},
                    ],
                    keywords: ''
                },
                methods: {
                    add () {
                        // 分析
                        // 1. 获取到 id 和 name， 直接从 data 上面获取
                        // 2. 组织出一个对象
                        // 3. 把这个对象，调用 数组的 相关方法，添加到 当前 data 上的 list 钟
                        // 4. 注意： 在 Vue 钟，已经实现了数据的双向绑定，每当我们改了 data 钟的数据，Vue会默认监听到数据的改动，自动把最新的数据，应用到页面上
                        // 5. 当我们意识到上面的第四步的时候，就证明大家已经入门 Vue 了，我们更多的是在进行 Vm 钟 Model 数据的操作，同时，在操作 Model 数据的时候，指定业务逻辑操作
                        var car = {id: this.id, name: this.name, ctime: new Date()};
                        this.list.push(car);
                        this.id = this.name = '';
                    },
                    del (id) { // 根据id删除数据
                        // 分析
                        // 1. 如何根据id，找到要删除这一项的索引
                        // 2. 如果找到索引了，直接调用 数组的 splice 方法

                        // this.list.some((item, i) => {
                        //     if (item.id == id) {
                        //         this.list.splice(i, 1);
                        //         // 在 数组的 some 方法钟，如果 return true，就会立即终止这个数组的后续循环
                        //         return true;
                        //     }
                        // });

                        var index = this.list.findIndex(item => {
                            if (item.id == id) {
                                return true;
                            }
                        });

                        this.list.splice(index, 1);
                    },
                    search () { // 根据关键字，进行数据搜索
                        var newList = [];
                        // this.list.forEach(item => {
                        //     if (item.name.indexOf(this.keywords) != -1) {
                        //         newList.push(item);
                        //     }
                        // });

                        // return newList;

                        return this.list.filter(item => {
                        // 注意：forEach some filter findIndex 这些都属于数组的新方法

                        // 注意：es6钟，为字符串提供了一个新方法，叫做 string.prototype.includes('要包含的字符串')
                        // 如果包含 true 否 false
                            if (item.name.includes(this.keywords)) {
                                return item;
                            }
                        });
                    }
                }
            });


            // 如果定义一个私有的过滤器
            var vm2 = new Vue({
                el: '#app2',
                data: {
                    dt: new Date()
                },
                methods: {},
                filters: {// 定义私有过滤器     两个条件 【过滤器名称 和 处理函数】
                    // 过滤器调用的时候，采用的是就近原则，如果私有过滤器和全局过滤器名称一致了，这时候，优先调用私有过滤器.
                    dateFormat: function (dateStr, pattern) {
                        var dt = new Date(dataStr);

                        // yyyy-mm-dd
                        var y = dt.getFullYear();
                        var m = dt.getMonth();
                        var d = dt.getDate();

                        if (pattern.toLowerCase() === '') {
                            return `${y}-${m}-${d}`
                        } else {
                            var hh = dt.getHours();
                            var mm = dt.getMinutes();
                            var ss = dt.getMinutes();

                            return `${y}-${m}-${d} ${hh}:${mm}:${ss}` + '~~~~~~~~~~'
                        }
                    }
                }
            });
            // 过滤器定义语法
            // Vue.filter('过滤器的名称', function() {
            // return data + '123'; })
        </script>
    </body>
</html>